# المواصفات الفنية الكاملة لتطبيق WanderLodge

## 1. مقدمة ونظرة عامة

### 1.1. هدف المشروع
WanderLodge هو تطبيق ويب اجتماعي مصمم ليكون المنصة المثالية للمسافرين والرحالة والمغامرين. يهدف التطبيق إلى إنشاء مجتمع مترابط حيث يمكن للمستخدمين مشاركة خططهم، والعثور على شركاء للسفر أو السكن، واكتشاف الأنشطة والفعاليات المحلية، وبناء شبكة من العلاقات مع أشخاص يشاركونهم نفس الشغف.

### 1.2. الجمهور المستهدف
- الرحالة (Backpackers) والمسافرون المنفردون.
- البدو الرقميون (Digital Nomads).
- الطلاب الذين يدرسون في الخارج.
- أي شخص يبحث عن مغامرات وتجارب سفر أصيلة.

### 1.3. المفهوم الأساسي
يقوم التطبيق على فكرة "المنشورات" (Posts) التي تمثل خططًا أو أنشطة مستقبلية. يمكن أن تكون هذه المنشورات متنوعة، مثل البحث عن رفيق لرحلة، أو عرض غرفة للإيجار، أو تنظيم فعالية محلية. يتفاعل المستخدمون مع هذه المنشورات ومع بعضهم البعض لبناء مجتمع سفر نابض بالحياة.

---

## 2. المتطلبات الوظيفية (Functional Requirements)

### 2.1. نظام المستخدمين والمصادقة
- **إنشاء حساب:**
    - يمكن للمستخدمين الجدد التسجيل باستخدام البريد الإلكتروني وكلمة المرور.
    - تتطلب عملية التسجيل: الاسم الكامل، اسم المستخدم (فريد)، البريد الإلكتروني، كلمة المرور، تاريخ الميلاد، والجنس.
    - يتم إرسال بريد إلكتروني لتأكيد الحساب (وظيفة Firebase الافتراضية).
- **تسجيل الدخول:**
    - يمكن للمستخدمين المسجلين الدخول باستخدام البريد الإلكتروني وكلمة المرور.
- **تسجيل الدخول الاجتماعي (معطل حاليًا):**
    - توجد أزرار لواجهة المستخدم لتسجيل الدخول عبر Google و Facebook، ولكنها حاليًا تقوم بملء بيانات وهمية في نموذج التسجيل.
- **إعادة تعيين كلمة المرور:**
    - يمكن للمستخدم الذي نسي كلمة المرور طلب إعادة تعيينها عبر البريد الإلكتروني.
- **وضع الضيف (Guest Mode):**
    - يمكن للمستخدمين تصفح التطبيق كـ "ضيف" بدون تسجيل الدخول.
    - وضع الضيف له صلاحيات محدودة: يمكنه رؤية المنشورات العامة فقط ولا يمكنه التفاعل (الإعجاب، التعليق، النشر، المتابعة، إلخ).
    - يتم عرض شريط علوي دائم لتشجيع الضيف على تسجيل الدخول أو إنشاء حساب.
- **تسجيل الخروج:**
    - يمكن للمستخدمين المسجلين الخروج من حساباتهم.

### 2.2. الصفحة الرئيسية (الخلاصة - Feed)
- **عرض المنشورات:**
    - تعرض الخلاصة قائمة بالمنشورات مرتبة زمنيًا (الأحدث أولاً).
    - تعرض المنشورات من المستخدمين الذين يتابعهم المستخدم الحالي، بالإضافة إلى منشورات المستخدم الحالي نفسه.
    - يتم تطبيق قواعد الخصوصية (يتم عرض المنشورات العامة، ومنشورات المتابعين، ومنشورات "التوائم" فقط وفقًا للشروط).
- **شريط القصص (Story Reel):**
    - يعرض في أعلى الخلاصة.
    - يظهر قصص المستخدمين الذين يتابعهم المستخدم.
    - يحتوي على زر لإضافة قصة جديدة للمستخدم الحالي.

### 2.3. القصص (Stories)
- **إنشاء قصة:**
    - يمكن للمستخدمين إضافة قصة جديدة عن طريق التقاط صورة مباشرة من الكاميرا أو رفع صورة/فيديو من الجهاز.
- **عرض القصص:**
    - عند النقر على قصة مستخدم، يتم فتح عارض بملء الشاشة.
    - يعرض العارض القصص واحدة تلو الأخرى مع أشرطة تقدم في الأعلى.
    - الصور تستمر لمدة 5 ثوانٍ، والفيديوهات تستمر لمدة الفيديو.
    - يمكن التنقل بين قصص نفس المستخدم بالنقر على يمين أو يسار الشاشة.
    - القصص تختفي تلقائيًا بعد 24 ساعة (من خلال منطق يعتمد على `createdAt`).

### 2.4. إنشاء المنشورات
- **نموذج الإنشاء:**
    - يمكن للمستخدمين إنشاء منشور جديد من خلال نموذج مخصص.
- **حقول المنشور:**
    - **نوع المنشور (Post Type):** قائمة منسدلة (سفر، سكن، فعالية، هايكنج، تخييم، تطوع، ركوب الدراجات).
    - **الخصوصية (Privacy):** قائمة منسدلة (عام، للمتابعين فقط، لتوائم الميلاد فقط).
    - **العنوان (Title):** حقل نصي إلزامي.
    - **الوصف (Description):** حقل نصي كبير إلزامي.
    - **مساعد الوصف بالذكاء الاصطناعي:** باستخدام Gemini API، يمكن للمستخدم إدخال كلمات رئيسية لتوليد وصف تلقائي.
    - **الوسائط (Media):** خيار لرفع صورة أو فيديو (اختياري).
    - **الموقع (Location):** حقل نصي إلزامي (مثل "لشبونة، البرتغال").
    - **الميزانية (Budget):** حقل رقمي بالدولار الأمريكي.
    - **تاريخ البدء والانتهاء:** حقول لاختيار التواريخ.

### 2.5. التفاعل مع المنشورات
- **إبداء الاهتمام (Interest):** ما يعادل "الإعجاب"، يزيد من عداد المهتمين بالمنشور.
- **التعليقات (Comments):** عند النقر، تفتح نافذة منبثقة (Modal) تعرض التعليقات وتسمح بإضافة تعليق جديد.
- **إعادة النشر (Repost):** إضافة المنشور إلى قائمة المنشورات المعاد نشرها في ملف المستخدم الشخصي.
- **الحفظ (Save):** حفظ المنشور للرجوع إليه لاحقًا. يظهر في تبويب "المنشورات المحفوظة" في الملف الشخصي والإعدادات.
- **المشاركة (Share):** محاولة مشاركة رابط المنشور باستخدام Web Share API.
- **تمييز كـ "مكتمل" (Mark as Done):** للمستخدمين الذين شاركوا في النشاط.

### 2.6. البحث والاستكشاف
- **شاشة البحث:**
    - حقل بحث رئيسي للبحث بالكلمات المفتاحية في العنوان، الوصف، والموقع.
- **فلاتر متقدمة:**
    - فلترة حسب نوع المنشور.
    - فلترة حسب المدينة.
    - فلترة حسب الميزانية القصوى.
    - فلترة حسب نطاق التواريخ (من - إلى).
- **عرض النتائج على الخريطة:** زر يظهر إذا كانت نتائج البحث تحتوي على منشورات ذات إحداثيات، وينقل المستخدم إلى شاشة الخريطة مع عرض تلك النتائج فقط.
- **البحث عن توأم الميلاد:**
    - ميزة خاصة تتيح للمستخدمين البحث عن مستخدمين آخرين يشاركونهم:
        - نفس تاريخ الميلاد بالضبط (يوم، شهر، سنة).
        - نفس اليوم والشهر فقط.
    - النتائج تعرض قائمة بالمستخدمين المطابقين مع خيارات للمتابعة أو المراسلة.

### 2.7. عرض الخريطة
- تستخدم Leaflet.js لعرض خريطة تفاعلية.
- تعرض بشكل افتراضي جميع المنشورات من نوع "فعالية" التي لها إحداثيات.
- عند الانتقال إليها من شاشة البحث، تعرض فقط نتائج البحث المفلترة.
- كل منشور يُمثل بدبوس على الخريطة. النقر على الدبوس يعرض نافذة منبثقة صغيرة باسم المنشور وموقعه.

### 2.8. الملف الشخصي للمستخدم
- **ملفي الشخصي (My Profile):**
    - يعرض صورة الغلاف، الصورة الرمزية، الاسم، السيرة الذاتية، ومتوسط التقييم.
    - يعرض إحصائيات: عدد المغامرات (المنشورات)، عدد المتابعين، وعدد الذين يتابعهم.
    - أزرار للتنقل إلى الإعدادات ومشاركة الملف الشخصي.
- **ملف المستخدمين الآخرين (User Profile):**
    - نفس التصميم، مع أزرار "متابعة/إلغاء المتابعة" و "مراسلة".
    - إذا كان الحساب خاصًا، يتم حجب المحتوى ويظهر طلب للمتابعة.
- **تبويبات المحتوى:**
    - **المنشورات (Posts):** منشورات المستخدم.
    - **المنشورات المحفوظة (Saved):** (في ملفي الشخصي فقط).
    - **إعادة النشر (Reposts):** المنشورات التي أعاد المستخدم نشرها.
    - **الأنشطة المكتملة (Completed):** المنشورات التي تم تمييزها كمكتملة.
    - **الإحصائيات (Stats):** عرض رسوم بيانية وإحصائيات حول أنشطة المستخدم (الدول التي زارها، تفاصيل الأنشطة).

### 2.9. الرسائل والمحادثات (ميزة جزئية)
- **قائمة المحادثات:** شاشة لعرض قائمة بالمحادثات الأخيرة.
- **شاشة المحادثة:** شاشة لعرض الرسائل بين مستخدمين.
- *ملاحظة: هذه الميزة غير مرتبطة حاليًا بالخلفية (Backend) وتستخدم بيانات وهمية.*

### 2.10. الإشعارات
- لوحة منبثقة تعرض الإشعارات الأخيرة للمستخدم.
- أنواع الإشعارات: اهتمام جديد بمنشور، تعليق جديد، طلب تأكيد حضور، تأكيد حضور، طلب تقييم تجربة.

### 2.11. الإعدادات
- **شاشة الإعدادات الرئيسية:** قائمة للتنقل إلى الشاشات الفرعية.
- **تعديل الملف الشخصي:** تعديل الاسم، اسم المستخدم، السيرة الذاتية، الصور، كلمة المرور، والاهتمامات.
- **المنشورات المحفوظة:** شاشة مخصصة لعرض جميع المنشورات التي حفظها المستخدم.
- **الخصوصية والأمان:**
    - تفعيل/إلغاء تفعيل الحساب الخاص.
    - التحكم في رؤية قوائم المتابعين، الإحصائيات، والأنشطة المكتملة.
    - التحكم في الظهور في بحث توأم الميلاد.
- **اللغة:** اختيار لغة واجهة التطبيق.

### 2.12. دعم اللغات المتعددة
- يدعم التطبيق حاليًا اللغتين الإنجليزية والعربية.
- يتم تحديد اتجاه الواجهة (LTR/RTL) تلقائيًا بناءً على اللغة المختارة.

---

## 3. نماذج البيانات (Data Models / Schema)

هذه هي بنية البيانات الأساسية المخزنة في قاعدة بيانات Firestore.

### 3.1. `User` (مستخدم)
```typescript
interface User {
  id: string; // Firebase Auth UID
  name: string;
  username: string;
  email: string;
  avatarUrl?: string;
  coverUrl?: string;
  bio: string;
  interests: string[];
  birthday?: string; // 'YYYY-MM-DD'
  gender?: 'male' | 'female' | 'other' | 'prefer_not_to_say';
  followers: string[]; // array of user IDs
  following: string[]; // array of user IDs
  reposts: string[]; // array of post IDs
  savedPosts: string[]; // array of post IDs
  activityLog: { postId: string; status: 'Pending' | 'Confirmed'; }[];
  isPrivate: boolean;
  privacySettings: {
    showFollowLists: boolean;
    showStats: boolean;
    showCompletedActivities: boolean;
    allowTwinSearch: boolean;
  };
}
```

### 3.2. `Post` (منشور)
```typescript
interface Post {
  id: string; // Firestore document ID
  type: 'Travel' | 'Housing' | 'Event' | ...;
  authorId: string; // User ID
  title: string;
  description: string;
  location: string;
  coordinates?: { lat: number; lng: number };
  startDate: string; // ISO 8601 format
  endDate?: string; // ISO 8601 format
  budget: number;
  interestedUsers: string[]; // array of user IDs
  comments: Comment[]; // Sub-collection or array of objects
  createdAt: string; // ISO 8601 format
  media?: { url: string; type: 'image' | 'video'; }[];
  privacy: 'Public' | 'Followers' | 'Twins';
}
```

### 3.3. `Story` (قصة)
```typescript
interface Story {
  id: string; // Firestore document ID
  authorId: string; // User ID
  media: { url: string; type: 'image' | 'video'; };
  createdAt: string; // ISO 8601 format (used to determine expiration)
}
```

### 3.4. `Notification` (إشعار)
```typescript
interface Notification {
  id: string; // Firestore document ID
  type: 'interest' | 'comment' | 'message' | ...;
  recipientId: string; // User ID of the receiver
  userId: string; // User ID of the sender/actor
  postId?: string;
  text: string; // Generated text, e.g., "wants to confirm attendance..."
  createdAt: string;
  read: boolean;
}
```

---

## 4. تصميم واجهة المستخدم وتجربة المستخدم (UI/UX)

### 4.1. التصميم العام
- **Mobile-First:** تم تصميم التطبيق ليكون متجاوبًا ويعمل بشكل مثالي على الأجهزة المحمولة أولاً.
- **Desktop Layout:** على الشاشات الكبيرة (سطح المكتب)، يظهر شريط جانبي ثابت للتنقل، ومنطقة محتوى رئيسية في الوسط.
- **Mobile Layout:** على الشاشات الصغيرة، يتم استخدام شريط تنقل سفلي للوصول السريع إلى الشاشات الرئيسية.

### 4.2. لوحة الألوان والنمط
- يعتمد التصميم على نظام تصميم بسيط ونظيف باستخدام Tailwind CSS.
- اللون الرئيسي للتطبيق هو البرتقالي، يستخدم للعناصر التفاعلية والروابط.
- **الوضع الداكن (Dark Mode):** يدعم التطبيق وضعًا داكنًا يتكيف مع تفضيلات نظام التشغيل.

### 4.3. المكونات الرئيسية
- **النوافذ المنبثقة (Modals):** تستخدم لعرض التفاصيل التي تتطلب تركيزًا، مثل تفاصيل المنشور، قوائم المتابعين، إضافة قصة، وتقييم التجارب.
- **التنبيهات السريعة (Toasts):** رسائل صغيرة تظهر في أسفل الشاشة لتقديم ملاحظات فورية للمستخدم (مثل "تم حفظ الإعدادات").

---

## 5. الحزمة التقنية (Technical Stack)

- **الواجهة الأمامية (Frontend):**
    - **React 18:** مكتبة بناء واجهات المستخدم.
    - **TypeScript:** لإضافة أنواع ثابتة إلى JavaScript.
    - **Vite:** أداة بناء وتطوير سريعة.
    - **Tailwind CSS:** إطار عمل CSS لتصميم سريع ومخصص.
- **الخلفية والخدمات (Backend & Services):**
    - **Firebase:**
        - **Authentication:** لإدارة المستخدمين والمصادقة.
        - **Firestore:** قاعدة بيانات NoSQL لتخزين جميع بيانات التطبيق.
        - **Storage:** لتخزين ملفات الوسائط (الصور والفيديوهات).
- **واجهات برمجة التطبيقات (APIs):**
    - **Google Gemini API:** لتوليد أوصاف المنشورات باستخدام الذكاء الاصطناعي.
    - **Leaflet.js:** مكتبة مفتوحة المصدر للخرائط التفاعلية.

---

## 6. هيكل المشروع (Project Structure)

```
/src
├── components/     # مكونات React (شاشات، بطاقات، أزرار)
│   ├── icons/      # أيقونات SVG
│   └── settings/   # مكونات شاشات الإعدادات
├── contexts/       # React Contexts لإدارة الحالة (مثل اللغة)
├── services/       # وحدات للتفاعل مع APIs الخارجية (Firebase, Gemini)
├── utils/          # دوال مساعدة عامة
├── App.tsx         # المكون الجذري للتطبيق
├── types.ts        # تعريفات TypeScript لأنواع البيانات
└── index.css       # الأنماط الأساسية لـ Tailwind
```

# المواصفات الفنية الكاملة لتطبيق WanderLodge

## 1. مقدمة ونظرة عامة

### 1.1. هدف المشروع
WanderLodge هو تطبيق ويب اجتماعي مصمم ليكون المنصة المثالية للمسافرين والرحالة والمغامرين. يهدف التطبيق إلى إنشاء مجتمع مترابط حيث يمكن للمستخدمين مشاركة خططهم، والعثور على شركاء للسفر أو السكن، واكتشاف الأنشطة والفعاليات المحلية، وبناء شبكة من العلاقات مع أشخاص يشاركونهم نفس الشغف.

### 1.2. الجمهور المستهدف
- الرحالة (Backpackers) والمسافرون المنفردون.
- البدو الرقميون (Digital Nomads).
- الطلاب الذين يدرسون في الخارج.
- أي شخص يبحث عن مغامرات وتجارب سفر أصيلة.

### 1.3. المفهوم الأساسي
يقوم التطبيق على فكرة "المنشورات" (Posts) التي تمثل خططًا أو أنشطة مستقبلية. يمكن أن تكون هذه المنشورات متنوعة، مثل البحث عن رفيق لرحلة، أو عرض غرفة للإيجار، أو تنظيم فعالية محلية. يتفاعل المستخدمون مع هذه المنشورات ومع بعضهم البعض لبناء مجتمع سفر نابض بالحياة.

---

## 2. المتطلبات الوظيفية (Functional Requirements)

### 2.1. نظام المستخدمين والمصادقة
- **إنشاء حساب:**
    - يمكن للمستخدمين الجدد التسجيل باستخدام البريد الإلكتروني وكلمة المرور.
    - تتطلب عملية التسجيل: الاسم الكامل، اسم المستخدم (فريد)، البريد الإلكتروني، كلمة المرور، تاريخ الميلاد، الجنس، **والدولة**.
    - يتم إرسال بريد إلكتروني لتأكيد الحساب (وظيفة Firebase الافتراضية).
- **تسجيل الدخول:**
    - يمكن للمستخدمين المسجلين الدخول باستخدام البريد الإلكتروني وكلمة المرور.
- **تسجيل الدخول الاجتماعي:**
    - **Google:** تكامل كامل مع مصادقة جوجل. يمكن للمستخدمين التسجيل أو تسجيل الدخول بنقرة واحدة. عند التسجيل لأول مرة، يتم سحب الاسم والبريد الإلكتروني والصورة الرمزية تلقائيًا.
    - **Facebook:** (غير مفعل حاليًا).
- **إعادة تعيين كلمة المرور:**
    - يمكن للمستخدم الذي نسي كلمة المرور طلب إعادة تعيينها عبر البريد الإلكتروني.
- **وضع الضيف (Guest Mode):**
    - يمكن للمستخدمين تصفح التطبيق كـ "ضيف" بدون تسجيل الدخول.
    - وضع الضيف له صلاحيات محدودة: يمكنه رؤية المنشورات العامة فقط ولا يمكنه التفاعل (الإعجاب، التعليق، النشر، المتابعة، إلخ).
    - يتم عرض شريط علوي دائم لتشجيع الضيف على تسجيل الدخول أو إنشاء حساب.
- **تسجيل الخروج:**
    - يمكن للمستخدمين المسجلين الخروج من حساباتهم.

### 2.2. الصفحة الرئيسية (الخلاصة - Feed)
- **عرض المنشورات:**
    - تعرض الخلاصة قائمة بالمنشورات مرتبة زمنيًا (الأحدث أولاً).
    - تعرض المنشورات من المستخدمين الذين يتابعهم المستخدم الحالي، بالإضافة إلى منشورات المستخدم الحالي نفسه.
    - يتم تطبيق قواعد الخصوصية (يتم عرض المنشورات العامة، ومنشورات المتابعين، ومنشورات "التوائم" فقط وفقًا للشروط).
- **شريط القصص (Story Reel):**
    - يعرض في أعلى الخلاصة.
    - يظهر قصص المستخدمين الذين يتابعهم المستخدم.
    - يحتوي على زر لإضافة قصة جديدة للمستخدم الحالي.

### 2.3. القصص (Stories)
- **إنشاء قصة:**
    - يمكن للمستخدمين إضافة قصة جديدة عن طريق التقاط صورة مباشرة من الكاميرا أو رفع صورة/فيديو من الجهاز.
- **عرض القصص:**
    - عند النقر على قصة مستخدم، يتم فتح عارض بملء الشاشة.
    - يعرض العارض القصص واحدة تلو الأخرى مع أشرطة تقدم في الأعلى.
    - الصور تستمر لمدة 5 ثوانٍ، والفيديوهات تستمر لمدة الفيديو.
    - يمكن التنقل بين قصص نفس المستخدم بالنقر على يمين أو يسار الشاشة.
    - القصص تختفي تلقائيًا بعد 24 ساعة (من خلال منطق يعتمد على `createdAt`).

### 2.4. إنشاء وتعديل المنشورات
- **نموذج الإنشاء:**
    - يمكن للمستخدمين إنشاء منشور جديد من خلال نموذج مخصص.
- **حقول المنشور:**
    - **نوع المنشور (Post Type):** قائمة منسدلة (سفر، سكن، فعالية، هايكنج، تخييم، تطوع، ركوب الدراجات).
    - **الخصوصية (Privacy):** قائمة منسدلة (عام، للمتابعين فقط، لتوائم الميلاد فقط).
    - **العنوان (Title):** حقل نصي إلزامي.
    - **الوصف (Description):** حقل نصي كبير إلزامي.
    - **مساعد الوصف بالذكاء الاصطناعي:** باستخدام Gemini API، يمكن للمستخدم إدخال كلمات رئيسية لتوليد وصف تلقائي.
    - **الوسائط (Media):** خيار لرفع صورة أو فيديو (اختياري).
    - **الموقع (Location):** حقل نصي إلزامي.
    - **الإحداثيات (Coordinates):** حقول اختيارية لإدخال خطوط الطول والعرض يدويًا لربط المنشور بالخريطة بدقة.
    - **الميزانية (Budget):** حقل رقمي بالدولار الأمريكي.
    - **تاريخ البدء والانتهاء:** حقول لاختيار التواريخ.
- **إدارة المنشور:**
    - يمكن لصاحب المنشور **تعديل** جميع تفاصيل المنشور بعد نشره.
    - يمكن لصاحب المنشور **حذف** المنشور بشكل نهائي.
    - يمكن لصاحب المنشور **تغيير خصوصية** المنشور في أي وقت.

### 2.5. التفاعل مع المنشورات
- **إبداء الاهتمام (Interest):** ما يعادل "الإعجاب"، يزيد من عداد المهتمين بالمنشور.
- **التعليقات (Comments):** عند النقر، تفتح نافذة منبثقة (Modal) تعرض التعليقات وتسمح بإضافة تعليق جديد.
- **إعادة النشر (Repost):** إضافة المنشور إلى قائمة المنشورات المعاد نشرها في ملف المستخدم الشخصي.
- **الحفظ (Save):** حفظ المنشور للرجوع إليه لاحقًا. يظهر في تبويب "المنشورات المحفوظة" في الملف الشخصي والإعدادات.
- **المشاركة (Share):** محاولة مشاركة رابط المنشور باستخدام Web Share API.
- **تمييز كـ "مكتمل" (Mark as Done):** للمستخدمين الذين شاركوا في النشاط.

### 2.6. البحث والاستكشاف
- **شاشة البحث:**
    - حقل بحث رئيسي للبحث بالكلمات المفتاحية في العنوان، الوصف، والموقع.
- **فلاتر متقدمة:**
    - فلترة حسب نوع المنشور، المدينة، الميزانية القصوى، ونطاق التواريخ.
- **عرض النتائج على الخريطة:** زر يظهر إذا كانت نتائج البحث تحتوي على منشورات ذات إحداثيات، وينقل المستخدم إلى شاشة الخريطة مع عرض تلك النتائج فقط.
- **البحث عن توأم الميلاد:**
    - البحث عن مستخدمين آخرين يشاركونك نفس تاريخ الميلاد.
    - تظهر علامة "يتابعك" بجانب المستخدمين الذين يتابعونك في نتائج البحث.

### 2.7. عرض الخريطة
- تستخدم Leaflet.js لعرض خريطة تفاعلية.
- تعرض بشكل افتراضي جميع المنشورات من نوع "فعالية" التي لها إحداثيات.
- النقر على أيقونة الموقع في بطاقة المنشور ينقل المستخدم إلى الخريطة مع التركيز على موقع ذلك المنشور.

### 2.8. الملف الشخصي للمستخدم
- **ملفي الشخصي وملفات المستخدمين الآخرين:**
    - يعرض المعلومات الأساسية (الصور، الاسم، السيرة الذاتية، التقييم).
    - يعرض إحصائيات: عدد المغامرات، المتابعين، والمتابَعات.
- **تبويبات المحتوى:**
    - **المنشورات (Posts):** منشورات المستخدم.
    - **المنشورات المحفوظة (Saved):** (في ملفي الشخصي فقط).
    - **إعادة النشر (Reposts):** المنشورات التي أعاد المستخدم نشرها.
    - **الأنشطة المكتملة (Completed):** المنشورات التي تم تمييزها كمكتملة.
    - **الإحصائيات (Stats):**
        - **الدولة الأم:** تعرض الدولة التي اختارها المستخدم عند التسجيل.
        - **الدول التي تمت زيارتها:** قائمة بالأعلام للدول التي شارك فيها المستخدم بأنشطة مؤكدة.
        - تفاصيل الأنشطة المكتملة.

### 2.9. الرسائل والإشعارات
- **المراسلة الفردية:** نظام محادثات بين مستخدمين.
- **الإشعارات:**
    - لوحة منبثقة تعرض الإشعارات الأخيرة للمستخدم.
    - **إشعار رسالة جديدة:** يتم إرسال إشعار عند استلام رسالة جديدة.
    - **القراءة التلقائية:** يتم تمييز جميع الإشعارات كمقروءة عند فتح اللوحة.

### 2.10. الإعدادات
- **شاشة الإعدادات الرئيسية:** قائمة للتنقل إلى الشاشات الفرعية.
- **تعديل الملف الشخصي:** تعديل الاسم، اسم المستخدم، السيرة الذاتية، الصور، الاهتمامات.
- **المنشورات المحفوظة:** شاشة مخصصة لعرض جميع المنشورات التي حفظها المستخدم.
- **الخصوصية والأمان:** التحكم في خصوصية الحساب ورؤية الملف الشخصي.
- **اللغة:** اختيار لغة واجهة التطبيق.

### 2.11. دعم اللغات المتعددة
- يدعم التطبيق حاليًا اللغتين الإنجليزية والعربية.
- يتم تحديد اتجاه الواجهة (LTR/RTL) تلقائيًا بناءً على اللغة المختارة.

---

## 3. نماذج البيانات (Data Models / Schema)

### 3.1. `User` (مستخدم)
```typescript
interface User {
  id: string; // Firebase Auth UID
  name: string;
  username: string;
  email: string;
  avatarUrl?: string;
  coverUrl?: string;
  bio: string;
  interests: string[];
  birthday?: string; // 'YYYY-MM-DD'
  gender?: 'male' | 'female' | 'other' | 'prefer_not_to_say';
  country?: string; // e.g., "Jordan"
  followers: string[]; // array of user IDs
  following: string[]; // array of user IDs
  reposts: string[]; // array of post IDs
  savedPosts: string[]; // array of post IDs
  activityLog: { postId: string; status: 'Pending' | 'Confirmed'; }[];
  isPrivate: boolean;
  privacySettings: {
    showFollowLists: boolean;
    showStats: boolean;
    showCompletedActivities: boolean;
    allowTwinSearch: boolean;
  };
}
```

### 3.2. `Post` (منشور)
```typescript
interface Post {
  id: string; // Firestore document ID
  type: 'Travel' | 'Housing' | 'Event' | ...;
  authorId: string; // User ID
  title: string;
  description: string;
  location: string;
  coordinates?: { lat: number; lng: number };
  startDate: string; // ISO 8601 format
  endDate?: string; // ISO 8601 format
  budget: number;
  interestedUsers: string[]; // array of user IDs
  commentCount: number;
  createdAt: string; // ISO 8601 format
  media?: { url: string; type: 'image' | 'video'; }[];
  privacy: 'Public' | 'Followers' | 'Twins';
}
```

(نماذج `Story`, `Notification` وغيرها تبقى كما هي)

---

## 4. تصميم واجهة المستخدم وتجربة المستخدم (UI/UX)

(تبقى المواصفات كما هي)

---

## 5. الحزمة التقنية (Technical Stack)

(تبقى المواصفات كما هي)

---

## 6. هيكل المشروع (Project Structure)

```
/src
├── components/     # مكونات React (شاشات، بطاقات، أزرار)
│   ├── icons/      # أيقونات SVG
│   └── settings/   # مكونات شاشات الإعدادات
├── contexts/       # React Contexts لإدارة الحالة (مثل اللغة)
├── data/           # بيانات ثابتة (مثل قائمة الدول)
├── services/       # وحدات للتفاعل مع APIs الخارجية (Firebase, Gemini)
├── utils/          # دوال مساعدة عامة
├── App.tsx         # المكون الجذري للتطبيق
├── types.ts        # تعريفات TypeScript لأنواع البيانات
└── index.css       # الأنماط الأساسية لـ Tailwind
```
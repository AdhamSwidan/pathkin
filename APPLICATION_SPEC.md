# المواصفات الفنية الكاملة لتطبيق Pathkin

## 1. مقدمة ونظرة عامة

### 1.1. هدف المشروع
Pathkin هو تطبيق ويب اجتماعي مصمم ليكون المنصة المثالية للمسافرين والرحالة والمغامرين. يهدف التطبيق إلى إنشاء مجتمع مترابط حيث يمكن للمستخدمين مشاركة خططهم، والعثور على شركاء للسفر أو السكن، واكتشاف الأنشطة والفعاليات، وبناء شبكة من العلاقات مع أشخاص يشاركونهم نفس الشغف.

### 1.2. الجمهور المستهدف
- الرحالة (Backpackers) والمسافرون المنفردون.
- البدو الرقميون (Digital Nomads).
- الطلاب الذين يدرسون في الخارج.
- أي شخص يبحث عن مغامرات وتجارب سفر أصيلة.

### 1.3. المفهوم الأساسي
يقوم التطبيق على فكرة "المغامرات" (Adventures) التي تمثل خططًا أو أنشطة مستقبلية. يمكن أن تكون هذه المغامرات متنوعة، مثل البحث عن رفيق لرحلة، أو عرض غرفة للإيجار، أو تنظيم فعالية محلية. يتفاعل المستخدمون مع هذه المغامرات ومع بعضهم البعض لبناء مجتمع سفر نابض بالحياة.

---

## 2. المتطلبات الوظيفية (Functional Requirements)

### 2.1. نظام المستخدمين والمصادقة
- **إنشاء حساب:**
    - يمكن للمستخدمين الجدد التسجيل باستخدام البريد الإلكتروني وكلمة المرور.
    - تتطلب عملية التسجيل: الاسم الكامل، اسم المستخدم (فريد)، البريد الإلكتروني، كلمة المرور، تاريخ الميلاد، الجنس، **والدولة**.
    - يتم إرسال بريد إلكتروني لتأكيد الحساب (وظيفة Firebase الافتراضية).
- **تسجيل الدخول:**
    - يمكن للمستخدمين المسجلين الدخول باستخدام البريد الإلكتروني وكلمة المرور.
- **تسجيل الدخول الاجتماعي:**
    - **Google:** تكامل كامل مع مصادقة جوجل. يمكن للمستخدمين التسجيل أو تسجيل الدخول بنقرة واحدة. عند التسجيل لأول مرة، يتم سحب الاسم والبريد الإلكتروني والصورة الرمزية تلقائيًا.
    - **Facebook:** (غير مفعل حاليًا).
- **إعادة تعيين كلمة المرور:**
    - يمكن للمستخدم الذي نسي كلمة المرور طلب إعادة تعيينها عبر البريد الإلكتروني.
- **وضع الضيف (Guest Mode):**
    - يمكن للمستخدمين تصفح التطبيق كـ "ضيف" بدون تسجيل الدخول.
    - وضع الضيف له صلاحيات محدودة: يمكنه رؤية المغامرات العامة فقط ولا يمكنه التفاعل (الإعجاب، التعليق، النشر، المتابعة، إلخ).
    - يتم عرض شريط علوي دائم لتشجيع الضيف على تسجيل الدخول أو إنشاء حساب.
- **تسجيل الخروج:**
    - يمكن للمستخدمين المسجلين الخروج من حساباتهم.

### 2.2. الصفحة الرئيسية (الخلاصة - Feed)
- **عرض المغامرات:**
    - تعرض الخلاصة قائمة بالمغامرات مرتبة زمنيًا (الأحدث أولاً).
    - تعرض المغامرات من المستخدمين الذين يتابعهم المستخدم الحالي، بالإضافة إلى مغامرات المستخدم الحالي نفسه.
    - يتم تطبيق قواعد الخصوصية (يتم عرض المغامرات العامة، ومغامرات المتابعين، ومغامرات "التوائم" فقط وفقًا للشروط).
- **شريط القصص (Story Reel):**
    - يعرض في أعلى الخلاصة.
    - يظهر قصص المستخدمين الذين يتابعهم المستخدم.
    - يحتوي على زر لإضافة قصة جديدة للمستخدم الحالي.

### 2.3. القصص (Stories)
- **إنشاء قصة:**
    - يمكن للمستخدمين إضافة قصة جديدة عن طريق التقاط صورة مباشرة من الكاميرا أو رفع صورة/فيديو من الجهاز.
- **عرض القصص:**
    - عند النقر على قصة مستخدم، يتم فتح عارض بملء الشاشة.
    - يعرض العارض القصص واحدة تلو الأخرى مع أشرطة تقدم في الأعلى.
    - الصور تستمر لمدة 5 ثوانٍ، والفيديوهات تستمر لمدة الفيديو.
    - يمكن التنقل بين قصص نفس المستخدم بالنقر على يمين أو يسار الشاشة.
    - القصص تختفي تلقائيًا بعد 24 ساعة (من خلال منطق يعتمد على `createdAt`).

### 2.4. إنشاء وتعديل المغامرات
- **نموذج الإنشاء:**
    - يمكن للمستخدمين إنشاء مغامرة جديدة من خلال نموذج مخصص.
- **حقول المغامرة:**
    - **نوع المغامرة (Adventure Type):** قائمة منسدلة (سفر، سكن، فعالية، هايكنج، تخييم، تطوع، ركوب الدراجات).
    - **الخصوصية (Privacy):** قائمة منسدلة (عام، للمتابعين فقط، لتوائم الميلاد فقط).
    - **العنوان (Title):** حقل نصي إلزامي.
    - **الوصف (Description):** حقل نصي كبير إلزامي.
    - **مساعد الوصف بالذكاء الاصطناعي:** باستخدام Gemini API، يمكن للمستخدم إدخال كلمات رئيسية لتوليد وصف تلقائي.
    - **الوسائط (Media):** خيار لرفع صورة أو فيديو (اختياري).
    - **الموقع (Location):** حقل نصي ذكي مع اقتراحات تلقائية من Google Places API.
    - **اختيار من الخريطة (Select from Map):** بجانب حقل الموقع، يوجد زر يفتح نافذة خريطة تفاعلية. يمكن للمستخدم البحث عن مكان أو النقر مباشرة على الخريطة لتحديد الموقع. يتم بعد ذلك ملء حقل الموقع والإحداثيات تلقائيًا.
    - **الإحداثيات (Coordinates):** يتم حفظها تلقائيًا عند اختيار موقع من الاقتراحات أو الخريطة.
    - **الميزانية (Budget):** حقل رقمي بالدولار الأمريكي.
    - **تاريخ البدء والانتهاء:** حقول لاختيار التواريخ.
- **إدارة المغامرة:**
    - يمكن لصاحب المغامرة **تعديل** جميع تفاصيل المغامرة بعد نشرها.
    - يمكن لصاحب المغامرة **حذف** المغامرة بشكل نهائي.
    - يمكن لصاحب المغامرة **تغيير خصوصية** المغامرة في أي وقت.

### 2.5. التفاعل مع المغامرات
- **إبداء الاهتمام (Interest):** ما يعادل "الإعجاب"، يزيد من عداد المهتمين بالمغامرة.
- **التعليقات (Comments):** عند النقر، تفتح نافذة منبثقة (Modal) تعرض التعليقات وتسمح بإضافة تعليق جديد.
- **إعادة النشر (Repost):** إضافة المغامرة إلى قائمة المغامرات المعاد نشرها في ملف المستخدم الشخصي.
- **الحفظ (Save):** حفظ المغامرة للرجوع إليها لاحقًا. يظهر في تبويب "المغامرات المحفوظة" في الملف الشخصي والإعدادات.
- **المشاركة (Share):** محاولة مشاركة رابط المغامرة باستخدام Web Share API.
- **تمييز كـ "مكتمل" (Mark as Done):** للمستخدمين الذين شاركوا في النشاط.
- **استجابة فورية للواجهة (Optimistic UI):** تتغير ألوان وحالة أزرار (الحفظ، إعادة النشر، تمييز كمكتمل) فورًا عند النقر عليها لتقديم ملاحظات مرئية فورية للمستخدم دون انتظار استجابة الخادم.

### 2.6. البحث والاستكشاف
- **شاشة البحث:**
    - حقل بحث رئيسي للبحث بالكلمات المفتاحية في العنوان، الوصف، والموقع.
- **فلاتر متقدمة:**
    - فلترة حسب نوع المغامرة، المدينة، الميزانية القصوى، ونطاق التواريخ.
- **عرض النتائج على الخريطة:** زر يظهر إذا كانت نتائج البحث تحتوي على مغامرات ذات إحداثيات، وينقل المستخدم إلى شاشة الخريطة مع عرض تلك النتائج فقط.
- **البحث عن توأم الميلاد:**
    - البحث عن مستخدمين آخرين يشاركونك نفس تاريخ الميلاد.
    - تظهر علامة "يتابعك" بجانب المستخدمين الذين يتابعونك في نتائج البحث.

### 2.7. عرض الخريطة
- **عرض الخريطة التفاعلي:** تستخدم Google Maps Platform لعرض خريطة تفاعلية لجميع المغامرات التي لها إحداثيات.
- **عرض الموقع الحالي:** زر مخصص يسمح للمستخدم بطلب عرض موقعه الجغرافي الحالي على الخريطة بعد منحه الإذن اللازم.
- **أيقونات مخصصة:** تظهر كل مغامرة على الخريطة بعلامة (Marker) فريدة ومخصصة تعكس نوعها (مثل أيقونة جبل للهايكنج)، مما يسهل التمييز البصري.
- **فلترة حسب النوع:** شريط فلاتر أيقوني وواضح أعلى الخريطة يسمح للمستخدم بعرض أنواع معينة من المغامرات (مثل "تخييم" فقط) أو عرض جميع الأنواع.
- **الربط من المغامرات:** النقر على أيقونة الموقع في أي بطاقة مغامرة ينقل المستخدم إلى الخريطة مع التركيز على موقع تلك المغامة.

### 2.8. الملف الشخصي للمستخدم
- **ملفي الشخصي وملفات المستخدمين الآخرين:**
    - يعرض المعلومات الأساسية (الصور، الاسم، السيرة الذاتية، التقييم).
    - يعرض إحصائيات: عدد المغامرات، المتابعين، والمتابَعات.
- **تبويبات المحتوى:**
    - **المغامرات (Adventures):** مغامرات المستخدم.
    - **المغامرات المحفوظة (Saved):** (في ملفي الشخصي فقط).
    - **إعادة النشر (Reposts):** المغامرات التي أعاد المستخدم نشرها.
    - **الأنشطة المكتملة (Completed):** المغامرات التي تم تمييزها كمكتملة.
    - **الإحصائيات (Stats):**
        - **الدولة الأم:** تعرض الدولة التي اختارها المستخدم عند التسجيل.
        - **الدول التي تمت زيارتها:** قائمة بالأعلام للدول التي شارك فيها المستخدم بأنشطة مؤكدة.
        - تفاصيل الأنشطة المكتملة.

### 2.9. الرسائل والإشعارات
- **الإشعارات:**
    - تعرض شاشة الإشعارات قائمة بالتنبيهات الأخيرة للمستخدم، مجمعة حسب التاريخ (اليوم، الأمس، ...).
    - يتم إرسال إشعارات فورية للتفاعلات الجديدة، بما في ذلك:
        - **رسالة جديدة**.
        - **إبداء الاهتمام (Like)** بمغامرة المستخدم.
        - **تعليق جديد** على مغامرة المستخدم.
    - يتم عرض مؤشر مرئي (نقطة حمراء) في شريط التنقل عند وجود إشعارات غير مقروءة.
    - يتم تمييز جميع الإشعارات كمقروءة تلقائيًا عند زيارة شاشة الإشعارات.
- **نظام الرسائل (Messaging):**
    - **شاشة قائمة المحادثات:**
        - تعرض قائمة بجميع محادثات المستخدم، مرتبة حسب آخر رسالة.
        - تعرض كل محادثة: صورة المشارك، اسمه، نص آخر رسالة، ووقت وصولها.
        - **شارة الرسائل غير المقروءة:** يتم عرض "شارة" (Badge) برتقالية تعرض عدد الرسائل غير المقروءة في كل محادثة.
        - **تمييز غير المقروء:** يتم عرض اسم المرسل وآخر رسالة بخط **عريض** في المحادثات غير المقروءة.
    - **القراءة التلقائية:** بمجرد دخول المستخدم إلى محادثة معينة، يتم تحديث حالتها تلقائيًا وتختفي شارة الرسائل غير المقروءة.
    - **شاشة المحادثة التفصيلية:**
        - تصميم حديث وعملي يحاكي تطبيقات المراسلة الشهيرة.
        - يتم تجميع الرسائل تحت فواصل زمنية واضحة (مثل "اليوم"، "الأمس"، أو تاريخ محدد).
        - يتم عرض وقت الإرسال بجانب كل رسالة.
        - يتم تجميع الرسائل المتتالية من نفس المرسل بشكل مرئي لتقليل التكرار.

### 2.10. الإعدادات
- **شاشة الإعدادات الرئيسية:** قائمة للتنقل إلى الشاشات الفرعية.
- **تعديل الملف الشخصي:** تعديل الاسم، اسم المستخدم، السيرة الذاتية، الصور، الاهتمامات.
- **المغامرات المحفوظة:** شاشة مخصصة لعرض جميع المغامرات التي حفظها المستخدم.
- **الخصوصية والأمان:** التحكم في خصوصية الحساب ورؤية الملف الشخصي.
- **اللغة:** اختيار لغة واجهة التطبيق.

### 2.11. دعم اللغات المتعددة
- يدعم التطبيق حاليًا اللغتين الإنجليزية والعربية.
- يتم تحديد اتجاه الواجهة (LTR/RTL) تلقائيًا بناءً على اللغة المختارة.

---

## 3. نماذج البيانات (Data Models / Schema)

### 3.1. `User` (مستخدم)
```typescript
interface User {
  id: string; // Firebase Auth UID
  name: string;
  username: string;
  email: string;
  avatarUrl?: string;
  coverUrl?: string;
  bio: string;
  interests: string[];
  birthday?: string; // 'YYYY-MM-DD'
  gender?: 'male' | 'female' | 'other' | 'prefer_not_to_say';
  country?: string; // e.g., "Jordan"
  followers: string[]; // array of user IDs
  following: string[]; // array of user IDs
  repostedAdventures: string[]; // array of adventure IDs
  savedAdventures: string[]; // array of adventure IDs
  activityLog: { adventureId: string; status: 'Pending' | 'Confirmed'; }[];
  isPrivate: boolean;
  privacySettings: {
    showFollowLists: boolean;
    showStats: boolean;
    showCompletedActivities: boolean;
    allowTwinSearch: boolean;
  };
}
```

### 3.2. `Adventure` (مغامرة)
```typescript
interface Adventure {
  id: string; // Firestore document ID
  type: 'Travel' | 'Housing' | 'Event' | ...;
  authorId: string; // User ID
  title: string;
  description: string;
  location: string;
  coordinates?: { lat: number; lng: number };
  startDate: string; // ISO 8601 format
  endDate?: string; // ISO 8601 format
  budget: number;
  interestedUsers: string[]; // array of user IDs
  commentCount: number;
  createdAt: string; // ISO 8601 format
  media?: { url: string; type: 'image' | 'video'; }[];
  privacy: 'Public' | 'Followers' | 'Twins';
}
```

### 3.3. `Conversation` (محادثة)
```typescript
interface Conversation {
  id: string; // Firestore document ID (e.g., 'userId1_userId2')
  participants: string[]; // Array of two user IDs
  lastMessage?: Message;
  updatedAt: string; // ISO 8601 format, for sorting
  unreadCount?: { [key: string]: number; }; // Map of userId to unread count
}
```

(نماذج `Story`, `Notification`, `Message`, `Comment` تبقى كما هي مع تحديث `postId` إلى `adventureId` عند الحاجة)

---

## 4. تصميم واجهة المستخدم وتجربة المستخدم (UI/UX)
- **تصميم مركزي ومريح (Centered & Ergonomic Layout):** على الشاشات الكبيرة، يتم عرض المحتوى الرئيسي في منتصف الشاشة بعرض محدد (max-width)، مما يحسن من قابلية القراءة. يتم وضع القائمة الجانبية في أقصى اليسار لتجربة استخدام تشبه تطبيقات سطح المكتب الاحترافية.
- **تصميم متجاوب:** يتكيف التصميم بسلاسة مع أحجام الشاشات المختلفة، من الجوال إلى الأجهزة اللوحية إلى سطح المكتب.
- **هوية بصرية:** استخدام متسق للون البرتقالي كعلامة تجارية، مع نظام ألوان يدعم الوضعين الفاتح والداكن.
- **أيقونات مخصصة:** استخدام مجموعة أيقونات متناسقة لتعزيز الفهم البصري.
- **رسوم متحركة دقيقة:** استخدام رسوم متحركة بسيطة (مثل `fade-in`) لتحسين تجربة المستخدم دون إبطاء الواجهة.

---

## 5. الحزمة التقنية (Technical Stack)
- **الواجهة الأمامية (Frontend):** React, TypeScript, Vite, Tailwind CSS
- **الخلفية وقاعدة البيانات (Backend & Database):** Firebase (Authentication, Firestore, Storage)
- **واجهات برمجة التطبيقات (APIs):**
    - **Google Maps Platform:** for Places Autocomplete, Geocoding, and Map display.
    - **Google Gemini API:** for AI-powered description generation.
- **النشر (Deployment):** GitHub Pages

---

## 6. هيكل المشروع (Project Structure)

```
/src
├── components/     # مكونات React (شاشات، بطاقات، أزرار)
│   ├── icons/      # أيقونات SVG
│   └── settings/   # مكونات شاشات الإعدادات
├── contexts/       # React Contexts لإدارة الحالة (مثل اللغة)
├── data/           # بيانات ثابتة (مثل قائمة الدول)
├── services/       # وحدات للتفاعل مع APIs الخارجية (Firebase, Gemini)
├── utils/          # دوال مساعدة عامة
├── App.tsx         # المكون الجذري للتطبيق
├── types.ts        # تعريفات TypeScript لأنواع البيانات
└── index.css       # الأنماط الأساسية لـ Tailwind
```